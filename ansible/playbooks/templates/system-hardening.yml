---
- name: System Hardening
  hosts: all
  become: yes
  tasks:
    - name: Ensure UFW is installed and enabled
      apt:
        name: ufw
        state: present
      when: ansible_os_family == 'Debian'
    - name: Enable UFW
      ufw:
        state: enabled
        policy: deny
      when: ansible_os_family == 'Debian'
    - name: Disable root SSH login
      lineinfile:
        path: /etc/ssh/sshd_config
        regexp: '^PermitRootLogin'
        line: 'PermitRootLogin no'
      notify: Restart ssh
  handlers:
    - name: Restart ssh
      service:
        name: ssh
        state: restarted
